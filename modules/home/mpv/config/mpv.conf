############################################################
# mpv.conf — Intel Meteor Lake (Ultra 7) + Wayland (Niri)
# 
# Optimize Edilmiş: 21.12.2025
# Hedef: YouTube A/V Sync Çözümü + Kişisel Ayarların Korunması
############################################################

#######################
# GPU / Video Backend Ayarları
#######################
vo=gpu                           # 'gpu-next' hata verdiği için klasik 'gpu' backend'e dönüş
gpu-api=opengl                   # Vulkan yerine OpenGL (daha kararlı)
gpu-context=wayland              # Native Wayland context
hwdec=vaapi                      # Intel VAAPI donanım decode

# Intel QuickSync & Meteor Lake Optimizasyonları
hwdec-codecs=h264,hevc,vp8,vp9   # AV1 HARİÇ codec'ler (VP9 için kritik!)
vd-lavc-fast=no                  # Fast mode KAPALI (kalite öncelikli)
vd-lavc-skiploopfilter=none      # Loop filter'ı ATLAMA

# Shader Cache
gpu-shader-cache-dir=~/.cache/mpv/shaders

#######################
# Video Senkronizasyon & Timing (A/V SYNC FIX)
#######################
# Desync sorunu için sadeleştirilmiş ve güvenli ayarlar:
video-sync=audio                 # Sese senkronize et (Master: Audio)
interpolation=no                 # Frame interpolation KAPALI (sync sorunlarını önler)
framedrop=decoder                # Gerekirse frame drop et (sync'i koru)

# A/V Sync Toleransları (Standart değerlere dönüş)
video-sync-max-video-change=0.002
video-sync-max-audio-change=0.002

#######################
# Ölçekleme & Görüntü Kalitesi
#######################
scale=ewa_lanczossharp           # Kaliteli upscaling
cscale=ewa_lanczossharp
dscale=mitchell

#######################
# Seek & Playback Davranışı
#######################
hr-seek=yes                      # High resolution seeking
hr-seek-framedrop=no
save-position-on-quit=yes        # Çıkışta pozisyonu kaydet
resume-playback=yes              # Kaldığı yerden devam et
watch-later-directory=~/.cache/mpv/watch_later
prefetch-playlist=yes

#######################
# Önbellek & I/O Optimizasyonu
#######################
demuxer-thread=yes
cache=yes
# Streaming için dengeli buffer ayarları
demuxer-readahead-secs=20
cache-secs=120
demuxer-max-bytes=150MiB
demuxer-max-back-bytes=50MiB

# Otomatik Duraklatma (Buffer dolana kadar)
cache-pause=yes
cache-pause-wait=1.0
cache-pause-initial=yes

#######################
# Ses Sistemi & Senkronizasyon
#######################
ao=pipewire
audio-pitch-correction=yes
audio-channels=stereo
gapless-audio=weak
audio-normalize-downmix=yes

# Streaming için güvenli ses ayarları (Desync önleyici)
audio-buffer=0.2                 # 200ms buffer (daha stabil)
audio-wait-open=0                # Bekleme yapma
audio-stream-silence=no          # SORUNLU AYAR: Kapalı tutuyoruz.

#######################
# Pencere & Kullanıcı Arayüzü
#######################
input-ipc-server=/tmp/mpvsocket
border=no
keep-open=yes
idle=once
msg-color=yes
msg-module=yes
cursor-autohide=100
cursor-autohide-fs-only=no
autofit=85%x85%
autofit-larger=95%x95%
force-window=immediate

# OSD (On-Screen Display)
osc=no
osd-bar=yes
osd-bar-align-y=1
osd-bar-h=2
osd-bar-w=60
osd-duration=2000
osd-level=1
osd-font='Hack Nerd Font'
osd-font-size=24
osd-color='#CCFFFFFF'
osd-border-color='#DD322640'
osd-border-size=1
osd-shadow-color='#000000'
osd-shadow-offset=1
osd-spacing=0.5

#######################
# Altyazı Ayarları (Restore Edildi)
#######################
sub-auto=fuzzy
sub-file-paths-append=ass
sub-file-paths-append=srt
sub-file-paths-append=sub
sub-scale=1.0
sub-fix-timing=yes
sub-ass-override=force
sub-gauss=0.6
sub-filter-sdh=yes
sub-visibility=yes
blend-subtitles=no
sub-fonts-dir=~/.local/share/fonts
sub-font='Hack Nerd Font'
sub-font-size=36
sub-color='#FFFFFF'
sub-border-color='#000000'
sub-border-size=2
sub-shadow-offset=1
sub-shadow-color='#000000'

#######################
# Ekran Görüntüsü Ayarları (Restore Edildi)
#######################
screenshot-directory=~/Pictures/mpv-screenshots
screenshot-template="%F-%P"
screenshot-format=png
screenshot-high-bit-depth=yes
screenshot-png-compression=7
screenshot-tag-colorspace=yes

#######################
# Dil Tercihleri
#######################
slang=tur,tr,eng,en
alang=tur,tr,eng,en

#######################
# Ağ & Stream Dayanıklılığı
#######################
network-timeout=20
tls-verify=yes
stream-lavf-o-append=reconnect_streamed=1
stream-lavf-o-append=reconnect_on_network_error=1
stream-lavf-o-append=reconnect_delay_max=30

#######################
# YouTube / yt-dlp Ayarları
#######################
script-opts=ytdl_hook-ytdl_path=yt-dlp

# Cookie Ayarı (Brave) - Login sorununu çözer
ytdl-raw-options-append=cookies-from-browser=brave:/home/kenan/.brave/isolated/Kenp
ytdl-raw-options-append=sub-langs=tr,en
ytdl-raw-options-append=mark-watched=

# Profil: YouTube
[youtube-content]
profile-desc="YouTube Optimization"
profile-cond=path:match("youtu%.?be") ~= nil
# Brave cookie burada da garanti olsun diye tekrar tanımlanabilir veya globalden alır.
ytdl-format=bestvideo*[height<=?1440][fps<=?60][vcodec!=av01][vcodec!=av1]+bestaudio/best

# Profil: 4K
[4k-video]
profile-desc="4K Content"
profile-cond=width >= 3840
demuxer-max-bytes=300MiB

# Profil: Canlı Yayın (Low Latency)
[live-hls]
profile-desc="Live Streaming"
profile-cond=p.duration == 0 or demuxer == "hls"
cache=yes
demuxer-readahead-secs=5
audio-buffer=0.1
