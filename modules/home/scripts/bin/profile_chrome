#!/usr/bin/env bash
#-eua

# Eğer parametre verilmediyse profilleri listele
if [ $# -eq 0 ]; then
  echo "Mevcut profiller:"
  jq -r '.profile.info_cache | to_entries | map(.key + ": " + .value.name) | .[]' <~/.config/google-chrome/Local\ State | sort -k1,1 -k2,2n
  echo -e "\nKullanım: $0 <profil_ismi> [chrome_parametreleri]"
  exit 0
fi

profile_name=$1
shift
local_state=~/.config/google-chrome/Local\ State

# Profil anahtarını bul
profile_key=$(jq <"$local_state" -r '
    .profile.info_cache | to_entries | .[] |
    select(.value.name == env.profile_name) | .key')

# Profil anahtarı boş değilse Chrome'u başlat
if [ -n "$profile_key" ]; then
  google-chrome-stable --profile-directory="$profile_key" "$@"
else
  echo "Hata: '$profile_name' isimli profil bulunamadı."
  exit 1
fi
